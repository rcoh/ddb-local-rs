# ddb-local-rs

A local DynamoDB implementation in Rust, built with [Smithy](https://smithy.io/). Useful for testing without hitting AWS.

Currently supports `GetItem`, `PutItem`, and `CreateTable` operations with an in-memory backend.

## Usage

Add to your `Cargo.toml`:

```toml
[dev-dependencies]
ddb-local = { git = "https://github.com/rcoh/ddb-local-rs" }
```

### In-memory (no network)

```rust
use ddb_local::DynamoDbLocal;
use aws_sdk_dynamodb::types::AttributeValue;

#[tokio::test]
async fn test_dynamodb() {
    let local = DynamoDbLocal::builder().as_http_client();
    let client = local.client().await;

    // Use the client like normal
    client.put_item()
        .table_name("test-table")
        .item("id", AttributeValue::S("123".into()))
        .send()
        .await
        .unwrap();
}
```

### Network server

```rust
use ddb_local::DynamoDbLocal;

#[tokio::main]
async fn main() {
    let local = DynamoDbLocal::builder()
        .bind()
        .await
        .unwrap();

    println!("DynamoDB running at {}", local.endpoint_url());

    // Get a pre-configured client
    let client = local.client().await;
}
```

Or bind to a specific address:

```rust
let local = DynamoDbLocal::builder()
    .bind_to_address("127.0.0.1:8000")
    .await
    .unwrap();
```

## Building

Generate the server SDK from the Smithy model:

```bash
./gradlew build
```

Then build the Rust code:

```bash
cargo build
```

## Testing

Run tests against the in-memory implementation:

```bash
cargo test
```

To validate against real DynamoDB Local:

```bash
# Start DynamoDB Local
./scripts/run-dynamodb-local.sh

# In another terminal, run tests
cargo test
```

See [docs/TESTING_AGAINST_DYNAMODB_LOCAL.md](docs/TESTING_AGAINST_DYNAMODB_LOCAL.md) for details on writing tests that run against both backends.

## Running the standalone server

```bash
cargo run --bin ddb-local
```

This starts a server on `localhost:8888` that you can hit with the AWS SDK or CLI.

## Project Structure

- `smithy/` - Smithy model definition and code generation
- `server-sdk/` - Generated Rust server SDK (generated by Smithy)
- `ddb-local/` - DynamoDB implementation and standalone server

## Development

See [docs/ADDING_A_NEW_OPERATION.md](docs/ADDING_A_NEW_OPERATION.md) for a guide on adding new DynamoDB operations.

See [AGENTS.md](AGENTS.md) for detailed architecture and development context.

## Development

See [docs/ADDING_A_NEW_OPERATION.md](docs/ADDING_A_NEW_OPERATION.md) for a guide on adding new DynamoDB operations.

See [AGENTS.md](AGENTS.md) for detailed architecture and development context.
